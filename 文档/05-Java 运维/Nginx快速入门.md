# Nginxå¿«é€Ÿå…¥é—¨

> åœ¨ä½å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªjaråŒ…å¯åŠ¨åº”ç”¨å°±å¤Ÿäº†ï¼Œç„¶åå†…éƒ¨tomcatè¿”å›å†…å®¹ç»™ç”¨æˆ·ã€‚

![image-20230106131200762](Nginx/image-20230106131200762.png)

- éšç€ç”¨æˆ·è¶Šæ¥è¶Šå¤šäº†ï¼Œå¹¶å‘é‡æ…¢æ…¢å¢å¤§äº†ï¼Œæ­¤æ—¶ä¸€å°æœåŠ¡å™¨æ»¡è¶³ä¸äº†éœ€æ±‚äº†ã€‚

![image-20230106131358002](Nginx/image-20230106131358002.png)

- äºæ˜¯è¿›è¡Œæ¨ªå‘æ‰©å±•ï¼Œåˆå¢åŠ äº†æœåŠ¡å™¨ã€‚è¿™ä¸ªæ—¶å€™å‡ ä¸ªé¡¹ç›®å¯åŠ¨åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œç”¨æˆ·è¦è®¿é—®ï¼Œå°±éœ€è¦å¢åŠ ä¸€ä¸ªä»£ç†æœåŠ¡å™¨äº†ï¼Œé€šè¿‡ä»£ç†æœåŠ¡å™¨æ¥å¸®å¼€å‘è€…è½¬å‘å’Œå¤„ç†è¯·æ±‚ã€‚

![image-20230106131525639](Nginx/image-20230106131525639.png)

- å¼€å‘è€…å¸Œæœ›è¿™ä¸ªä»£ç†æœåŠ¡å™¨å¯ä»¥å¸®åŠ©å¼€å‘è€…æ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚ï¼Œç„¶åå°†ç”¨æˆ·çš„è¯·æ±‚æŒ‰ç…§è§„åˆ™å¸®å¼€å‘è€…è½¬å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨èŠ‚ç‚¹ä¹‹ä¸Šã€‚è¿™ä¸ªè¿‡ç¨‹ç”¨æˆ·æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œç”¨æˆ·å¹¶ä¸çŸ¥é“æ˜¯å“ªä¸ªæœåŠ¡å™¨è¿”å›çš„ç»“æœï¼Œå¼€å‘è€…è¿˜å¸Œæœ›ä»–å¯ä»¥æŒ‰ç…§æœåŠ¡å™¨çš„æ€§èƒ½æä¾›ä¸åŒçš„æƒé‡é€‰æ‹©ã€‚ä¿è¯æœ€ä½³ä½“éªŒï¼æ‰€ä»¥éœ€è¦ä½¿ç”¨Nginxã€‚

## 1.ä»€ä¹ˆæ˜¯Nginxï¼Ÿ

Nginx (engine x) æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„HTTPå’Œåå‘ä»£ç†webæœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†IMAP/POP3/SMTPæœåŠ¡ã€‚Nginxæ˜¯ç”±ä¼Šæˆˆå°”Â·èµ›ç´¢è€¶å¤«ä¸ºä¿„ç½—æ–¯è®¿é—®é‡ç¬¬äºŒçš„Rambler.ruç«™ç‚¹ï¼ˆä¿„æ–‡ï¼šĞ Ğ°Ğ¼Ğ±Ğ»ĞµÑ€ï¼‰å¼€å‘çš„ï¼Œç¬¬ä¸€ä¸ªå…¬å¼€ç‰ˆæœ¬0.1.0å‘å¸ƒäº2004å¹´10æœˆ4æ—¥ã€‚2011å¹´6æœˆ1æ—¥ï¼Œnginx 1.0.4å‘å¸ƒã€‚

å…¶ç‰¹ç‚¹æ˜¯å æœ‰å†…å­˜å°‘ï¼Œå¹¶å‘èƒ½åŠ›å¼ºï¼Œäº‹å®ä¸Šnginxçš„å¹¶å‘èƒ½åŠ›åœ¨åŒç±»å‹çš„ç½‘é¡µæœåŠ¡å™¨ä¸­è¡¨ç°è¾ƒå¥½ï¼Œä¸­å›½å¤§é™†ä½¿ç”¨nginxç½‘ç«™ç”¨æˆ·æœ‰ï¼šç™¾åº¦ã€äº¬ä¸œã€æ–°æµªã€ç½‘æ˜“ã€è…¾è®¯ã€æ·˜å®ç­‰ã€‚åœ¨å…¨çƒæ´»è·ƒçš„ç½‘ç«™ä¸­æœ‰12.18%çš„ä½¿ç”¨æ¯”ç‡ï¼Œå¤§çº¦ä¸º2220ä¸‡ä¸ªç½‘ç«™ã€‚

Nginx æ˜¯ä¸€ä¸ªå®‰è£…éå¸¸çš„ç®€å•ã€é…ç½®æ–‡ä»¶éå¸¸ç®€æ´ï¼ˆè¿˜èƒ½å¤Ÿæ”¯æŒperlè¯­æ³•ï¼‰ã€Bugéå¸¸å°‘çš„æœåŠ¡ã€‚Nginx å¯åŠ¨ç‰¹åˆ«å®¹æ˜“ï¼Œå¹¶ä¸”å‡ ä¹å¯ä»¥åšåˆ°7*24ä¸é—´æ–­è¿è¡Œï¼Œå³ä½¿è¿è¡Œæ•°ä¸ªæœˆä¹Ÿä¸éœ€è¦é‡æ–°å¯åŠ¨ã€‚ä½ è¿˜èƒ½å¤Ÿä¸é—´æ–­æœåŠ¡çš„æƒ…å†µä¸‹è¿›è¡Œè½¯ä»¶ç‰ˆæœ¬çš„å‡çº§ã€‚

Nginxä»£ç å®Œå…¨ç”¨Cè¯­è¨€ä»å¤´å†™æˆã€‚å®˜æ–¹æ•°æ®æµ‹è¯•è¡¨æ˜èƒ½å¤Ÿæ”¯æŒé«˜è¾¾ 50,000 ä¸ªå¹¶å‘è¿æ¥æ•°çš„å“åº”ã€‚

## 2.Nginxä½œç”¨ï¼Ÿ

> Httpä»£ç†ï¼Œåå‘ä»£ç†ï¼šä½œä¸ºwebæœåŠ¡å™¨æœ€å¸¸ç”¨çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œå°¤å…¶æ˜¯åå‘ä»£ç†ã€‚

- æ­£å‘ä»£ç†
  ![img](Nginx/demo01.png)

- åå‘ä»£ç†
  ![img](Nginx/demo02.png)

> Nginxæä¾›çš„è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰2ç§ï¼šå†…ç½®ç­–ç•¥å’Œæ‰©å±•ç­–ç•¥ã€‚å†…ç½®ç­–ç•¥ä¸ºè½®è¯¢ï¼ŒåŠ æƒè½®è¯¢ï¼ŒIp hashã€‚æ‰©å±•ç­–ç•¥ï¼Œå°±å¤©é©¬è¡Œç©ºï¼Œåªæœ‰ä½ æƒ³ä¸åˆ°çš„æ²¡æœ‰ä»–åšä¸åˆ°çš„ã€‚

- è½®è¯¢
  ![img](Nginx/demo03.png)

- åŠ æƒè½®è¯¢
  ![img](Nginx/demo04.png)

- iphashå¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„ipè¿›è¡Œhashæ“ä½œï¼Œç„¶åæ ¹æ®hashç»“æœå°†åŒä¸€ä¸ªå®¢æˆ·ç«¯ipçš„è¯·æ±‚åˆ†å‘ç»™åŒä¸€å°æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥è§£å†³sessionä¸å…±äº«çš„é—®é¢˜ã€‚
  ![img](Nginx/demo05.png)

> åŠ¨é™åˆ†ç¦»ï¼Œåœ¨æ—¥å¸¸çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œæœ‰äº›è¯·æ±‚æ˜¯éœ€è¦åå°å¤„ç†çš„ï¼Œæœ‰äº›è¯·æ±‚æ˜¯ä¸éœ€è¦ç»è¿‡åå°å¤„ç†çš„ï¼ˆå¦‚ï¼šcssã€htmlã€jpgã€jsç­‰ç­‰æ–‡ä»¶ï¼‰ï¼Œè¿™äº›ä¸éœ€è¦ç»è¿‡åå°å¤„ç†çš„æ–‡ä»¶ç§°ä¸ºé™æ€æ–‡ä»¶ã€‚è®©åŠ¨æ€ç½‘ç«™é‡Œçš„åŠ¨æ€ç½‘é¡µæ ¹æ®ä¸€å®šè§„åˆ™æŠŠä¸å˜çš„èµ„æºå’Œç»å¸¸å˜çš„èµ„æºåŒºåˆ†å¼€æ¥ï¼ŒåŠ¨é™èµ„æºåšå¥½äº†æ‹†åˆ†ä»¥åï¼Œå¼€å‘è€…å°±å¯ä»¥æ ¹æ®é™æ€èµ„æºçš„ç‰¹ç‚¹å°†å…¶åšç¼“å­˜æ“ä½œã€‚æé«˜èµ„æºå“åº”çš„é€Ÿåº¦ã€‚

![img](Nginx/demo06.png)

ç›®å‰ï¼Œé€šè¿‡ä½¿ç”¨Nginxå¤§å¤§æé«˜äº†ç½‘ç«™çš„å“åº”é€Ÿåº¦ï¼Œä¼˜åŒ–äº†ç”¨æˆ·ä½“éªŒï¼Œè®©ç½‘ç«™çš„å¥å£®æ€§æ›´ä¸Šä¸€å±‚æ¥¼ï¼

## 3.Nginxçš„å®‰è£…

### 1.windowsä¸‹å®‰è£…

**1ã€ä¸‹è½½nginx**

- [http://nginx.org/en/download.html](http://nginx.org/en/download.html)ä¸‹è½½ç¨³å®šç‰ˆæœ¬ã€‚
- ä¸ªäººç½‘ç›˜åœ°å€é“¾æ¥ï¼š[https://pan.baidu.com/s/1N2y01sWyxos34989csRQ9Q?pwd=y3zc](https://pan.baidu.com/s/1N2y01sWyxos34989csRQ9Q?pwd=y3zc ) 
- ä»¥nginx/Windows-1.22.1ä¸ºä¾‹ï¼Œç›´æ¥ä¸‹è½½ nginx-1.22.1.zipã€‚![image-20230106135307505](Nginx/image-20230106135307505.png)
- ä¸‹è½½åè§£å‹ï¼Œè§£å‹åå¦‚ä¸‹ï¼š![image-20230106135751865](Nginx/image-20230106135751865.png)

**2ã€å¯åŠ¨nginx**

- æœ‰å¾ˆå¤šç§æ–¹æ³•å¯åŠ¨nginxï¼›

- (1)ç›´æ¥åŒå‡»nginx.exeï¼ŒåŒå‡»åä¸€ä¸ªé»‘è‰²çš„å¼¹çª—ä¸€é—ªè€Œè¿‡ã€‚

- (2)æ‰“å¼€cmdå‘½ä»¤çª—å£ï¼Œåˆ‡æ¢åˆ°nginxè§£å‹ç›®å½•ä¸‹ï¼Œè¾“å…¥å‘½ä»¤ `nginx.exe`ï¼Œå›è½¦å³å¯ã€‚![image-20230106135920617](Nginx/image-20230106135920617.png)

**3ã€æ£€æŸ¥nginxæ˜¯å¦å¯åŠ¨æˆåŠŸ**

- ç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ç½‘å€ [http://localhost:80](http://localhost/) å›è½¦ï¼Œå‡ºç°ä»¥ä¸‹é¡µé¢è¯´æ˜å¯åŠ¨æˆåŠŸï¼![image-20230106135944916](Nginx/image-20230106135944916.png)

**4ã€é…ç½®ç›‘å¬**

- nginxçš„é…ç½®æ–‡ä»¶æ˜¯confç›®å½•ä¸‹çš„nginx.confï¼Œé»˜è®¤é…ç½®çš„nginxç›‘å¬çš„ç«¯å£ä¸º80ï¼Œå¦‚æœ80ç«¯å£è¢«å ç”¨å¯ä»¥ä¿®æ”¹ä¸ºæœªè¢«å ç”¨çš„ç«¯å£å³å¯ã€‚![image-20230106140054871](Nginx/image-20230106140054871.png)

- å½“æˆ‘ä»¬ä¿®æ”¹äº†nginxçš„é…ç½®æ–‡ä»¶nginx.conf æ—¶ï¼Œä¸éœ€è¦å…³é—­nginxåé‡æ–°å¯åŠ¨nginxï¼Œåªéœ€è¦æ‰§è¡Œå‘½ä»¤ `nginx -s reload` å³å¯è®©æ”¹åŠ¨ç”Ÿæ•ˆã€‚

**5ã€å…³é—­nginx**

- å¦‚æœä½¿ç”¨cmdå‘½ä»¤çª—å£å¯åŠ¨nginxï¼Œ å…³é—­cmdçª—å£æ˜¯ä¸èƒ½ç»“æŸnginxè¿›ç¨‹çš„ï¼Œå¯ä½¿ç”¨ä¸¤ç§æ–¹æ³•å…³é—­nginxã€‚
- (1)è¾“å…¥nginxå‘½ä»¤ `nginx -s stop`(å¿«é€Ÿåœæ­¢nginx) æˆ– `nginx -s quit`(å®Œæ•´æœ‰åºçš„åœæ­¢nginx)ã€‚
- (2)ä½¿ç”¨taskkill `taskkill /f /t /im nginx.exe`

```shell
taskkillæ˜¯ç”¨æ¥ç»ˆæ­¢è¿›ç¨‹çš„ã€‚
/fæ˜¯å¼ºåˆ¶ç»ˆæ­¢ã€‚
/tç»ˆæ­¢æŒ‡å®šçš„è¿›ç¨‹å’Œä»»ä½•ç”±æ­¤å¯åŠ¨çš„å­è¿›ç¨‹ã€‚
/imç¤ºæŒ‡å®šçš„è¿›ç¨‹åç§°ã€‚
```

### 2.linuxä¸‹å®‰è£…

**1ã€å®‰è£…gcc**

- å®‰è£… nginx éœ€è¦å…ˆå°†å®˜ç½‘ä¸‹è½½çš„æºç è¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘ä¾èµ– gcc ç¯å¢ƒï¼Œå¦‚æœæ²¡æœ‰ gcc ç¯å¢ƒï¼Œåˆ™éœ€è¦å®‰è£…ï¼š

```yaml
yum install gcc-c++
```

**2ã€PCRE pcre-devel å®‰è£…**

- PCRE(Perl Compatible Regular Expressions) æ˜¯ä¸€ä¸ªPerlåº“ï¼ŒåŒ…æ‹¬ perl å…¼å®¹çš„æ­£åˆ™è¡¨è¾¾å¼åº“ã€‚nginx çš„ http æ¨¡å—ä½¿ç”¨ pcre æ¥è§£ææ­£åˆ™è¡¨è¾¾å¼ï¼Œæ‰€ä»¥éœ€è¦åœ¨ linux ä¸Šå®‰è£… pcre åº“ï¼Œpcre-devel æ˜¯ä½¿ç”¨ pcre å¼€å‘çš„ä¸€ä¸ªäºŒæ¬¡å¼€å‘åº“ã€‚nginxä¹Ÿéœ€è¦æ­¤åº“ã€‚å‘½ä»¤ï¼š

```yaml
yum install -y pcre pcre-devel
```

**3ã€zlib å®‰è£…**

- zlib åº“æä¾›äº†å¾ˆå¤šç§å‹ç¼©å’Œè§£å‹ç¼©çš„æ–¹å¼ï¼Œ nginx ä½¿ç”¨ zlib å¯¹ http åŒ…çš„å†…å®¹è¿›è¡Œ gzip ï¼Œæ‰€ä»¥éœ€è¦åœ¨ Centos ä¸Šå®‰è£… zlib åº“ã€‚

```yaml
yum install -y zlib zlib-devel
```

**4ã€OpenSSL å®‰è£…**

- OpenSSL æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å®‰å…¨å¥—æ¥å­—å±‚å¯†ç åº“ï¼Œå›Šæ‹¬ä¸»è¦çš„å¯†ç ç®—æ³•ã€å¸¸ç”¨çš„å¯†é’¥å’Œè¯ä¹¦å°è£…ç®¡ç†åŠŸèƒ½åŠ SSL åè®®ï¼Œå¹¶æä¾›ä¸°å¯Œçš„åº”ç”¨ç¨‹åºä¾›æµ‹è¯•æˆ–å…¶å®ƒç›®çš„ä½¿ç”¨ã€‚
- nginx ä¸ä»…æ”¯æŒ http åè®®ï¼Œè¿˜æ”¯æŒ httpsï¼ˆå³åœ¨sslåè®®ä¸Šä¼ è¾“httpï¼‰ï¼Œæ‰€ä»¥éœ€è¦åœ¨ Centos å®‰è£… OpenSSL åº“ã€‚

```yaml
yum install -y openssl openssl-devel
```

![image-20230106141349633](Nginx/image-20230106141349633.png)

**5ã€ä¸‹è½½å®‰è£…åŒ…**

- æ‰‹åŠ¨ä¸‹è½½.tar.gzå®‰è£…åŒ…ï¼Œåœ°å€ï¼š[https://nginx.org/en/download.html](https://nginx.org/en/download.html)

![image-20230106141041471](Nginx/image-20230106141041471.png)

- ä¸ªäººç½‘ç›˜åœ°å€é“¾æ¥ï¼š[https://pan.baidu.com/s/1TYloJ0Y5TvmOB5__0c__Ww?pwd=dxx3](https://pan.baidu.com/s/1TYloJ0Y5TvmOB5__0c__Ww?pwd=dxx3) 

- ä¸‹è½½å®Œæ¯•ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Š /rootã€‚![image-20230106141458210](Nginx/image-20230106141458210.png)

**6ã€è§£å‹**

```shell
tar -zxvf nginx-1.22.1.tar.gz
cd nginx-1.22.1/
ll
```

![image-20230106141907519](Nginx/image-20230106141907519.png)

**7ã€é…ç½®**

- ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œåœ¨nginxæ ¹ç›®å½•ä¸‹æ‰§è¡Œã€‚

```shell
./configure # è¿›è¡Œé…ç½®ï¼Œç›®çš„æ˜¯ä¸ºäº†åˆ›å»ºmakefileæ–‡ä»¶
make	# makeç¼–è¯‘
make install # å®‰è£…
```

![image-20230106142613509](Nginx/image-20230106142613509.png)

- æŸ¥æ‰¾å®‰è£…è·¯å¾„ï¼š `whereis nginx`![image-20230106142018257](Nginx/image-20230106142018257.png)

### 3.Nginxå¸¸ç”¨å‘½ä»¤

```shell
cd /usr/local/nginx/sbin/
./nginx  å¯åŠ¨
./nginx -s stop  åœæ­¢
./nginx -s quit  å®‰å…¨é€€å‡º
./nginx -s reload  é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶
ps aux|grep nginx  æŸ¥çœ‹nginxè¿›ç¨‹
```

- å¯åŠ¨æˆåŠŸè®¿é—®ï¼ŒæœåŠ¡å™¨ip:80

![image-20230106150711637](Nginx/image-20230106150711637.png)

> æŠ¥é”™nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)è§£å†³æ–¹æ³•

- æ–¹æ³•ä¸€ 

  ```shell
  fuser -k 80/tcp
  ```

  - å°†è¿›ç¨‹æ€æ­»åï¼Œå¯åŠ¨nginxã€‚

  ![image-20230106151033272](Nginx/image-20230106151033272.png)

- æ–¹æ³•äºŒ

  ```shell
  [root@localhost /]#ps -A | grep nginx 
  [root@localhost /]#kill -9 pid1
  [root@localhost /]#kill -9 pid2
  ```

  - å°†è¿›ç¨‹æ€æ­»åï¼Œå¯åŠ¨nginxã€‚

------

- æ³¨æ„ï¼š==å¦‚ä½•è¿æ¥ä¸ä¸Šï¼Œæ£€æŸ¥é˜¿é‡Œäº‘å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾ç«¯å£ï¼Œæˆ–è€…æœåŠ¡å™¨é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ç«¯å£==ï¼
- ç›¸å…³å‘½ä»¤ï¼š

```shell
# å¼€å¯
service firewalld start
# é‡å¯
service firewalld restart
# å…³é—­
service firewalld stop
# æŸ¥çœ‹é˜²ç«å¢™è§„åˆ™
firewall-cmd --list-all
# æŸ¥è¯¢ç«¯å£æ˜¯å¦å¼€æ”¾
firewall-cmd --query-port=8080/tcp
# å¼€æ”¾80ç«¯å£
firewall-cmd --permanent --add-port=80/tcp
# ç§»é™¤ç«¯å£
firewall-cmd --permanent --remove-port=8080/tcp
#é‡å¯é˜²ç«å¢™(ä¿®æ”¹é…ç½®åè¦é‡å¯é˜²ç«å¢™)
firewall-cmd --reload
# å‚æ•°è§£é‡Š
1ã€firwall-cmdï¼šæ˜¯Linuxæä¾›çš„æ“ä½œfirewallçš„ä¸€ä¸ªå·¥å…·ï¼›
2ã€--permanentï¼šè¡¨ç¤ºè®¾ç½®ä¸ºæŒä¹…ï¼›
3ã€--add-portï¼šæ ‡è¯†æ·»åŠ çš„ç«¯å£ï¼›
```

## 4.æ¼”ç¤º

![image-20230106152947940](Nginx/image-20230106152947940.png)

![image-20230106153215674](Nginx/image-20230106153215674.png)

- ä¸»è¦æ˜¯åœ¨serverè¿™é‡Œé…ç½®éœ€è¦çš„å³å¯ã€‚
- æ¡ˆä¾‹ï¼š

```shell
upstream lb{
    server 127.0.0.1:8080 weight=1;
    server 127.0.0.1:8081 weight=1;
}
location / {
    proxy_pass http://lb;
}
```

# ğŸ‰ç»“æŸğŸ‰